<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <title>Fantalucca 2K22</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  <script src='index.js'></script>

   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
</head>

<style>
	@import url('https://fonts.googleapis.com/css2?family=M+PLUS+2:wght@300&display=swap');
	*{ 
		font-family: 'M PLUS 2', sans-serif;}	
		font-weight:400;		
	 }
	 .squadra{
		color: #fd44aa;
		border: solid 4px #ffa000;
		border-radius:10px;
		padding:10px;	 
	 }
	 .btnMenu{
		font-size: 1.2em;
		width:33%;
	 }
	 .lbl{
		font-size:1.1em;
	 }
	.freccia{
		font-size:25px;
		color:#66d90e;
	 }
	.freccia:active{
		color:red;
		font-size:28px;
	}
	
	 .titolo{
		text-align: center;
		font-size: 1.5em;
		font-weight: bold;	
	}
	#loader{
		position: fixed;
		width: 100%;
		height: 100vh;
		background: #174573cf;
		z-index: 999;
	}
	
	.rotatingImage {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 120px;
    height: 120px;
    margin:-60px 0 0 -60px;
    -webkit-animation:spin 4s linear infinite;
    -moz-animation:spin 4s linear infinite;
    animation:spin 4s linear infinite;
	}
	@-moz-keyframes spin { 
		100% { -moz-transform: rotate(360deg); } 
	}
	@-webkit-keyframes spin { 
		100% { -webkit-transform: rotate(360deg); } 
	}
	@keyframes spin { 
		100% { 
			-webkit-transform: rotate(360deg); 
			transform:rotate(360deg); 
		} 
	}
	
	select{
		width:300px;
		font-weight: bold;
		padding: 0px 0 0 5px;
		height: 30px;
		background: #edeff1 !important;
		color: #16293c !important;
		cursor: pointer;
	}
	
	.ok{
	padding-left: 5px;
	font-size:3em;
	color:#FFFF00;
	animation-name: okAnimation;
		 animation-duration: 1.0s;
		 animation-iteration-count: 1;
	}
	 @keyframes okAnimation {	
		 from  {font-size:1.75em}		 
		 to{font-size:3em}		 
	 }
	 
	 .no{
	 padding-left: 5px;
	font-size:2.5em;
	color:#FF0000;
	animation-name: noAnimation;
		 animation-duration: 1.0s;
		 animation-iteration-count: 1;
	}
	 @keyframes noAnimation {	
		 from  {font-size:1.75em}		 
		 to{font-size:3em}		 
	 }
	 
	.coppa{		
		font-size: 20px;
		margin-right: 10px;
		float: right;
	}
	.Nicco, .Paolo{
		margin-top:-90px;
	}
	.h4, h4 {
		font-size: 1.2em;
	}
	table {
		font-size: 1.1em;
		background-color: transparent;
	}
</style>
 
<body  style = "background-color:#123456; color:#ffffff; overflow-x: hidden;">
	<div id="loader">
	<svg class="rotatingImage" version="1.0" xmlns="http://www.w3.org/2000/svg" style="top:280px;"
 width="256.000000pt" height="256.000000pt" viewBox="0 0 256.000000 256.000000"
 preserveAspectRatio="xMidYMid meet">

<g transform="translate(0.000000,256.000000) scale(0.100000,-0.100000)"
fill="#000000" stroke="none">
<path d="M1148 2489 c-332 -41 -663 -231 -864 -498 -107 -143 -193 -345 -225
-531 -17 -104 -15 -297 5 -402 85 -443 401 -807 824 -948 151 -50 233 -63 397
-63 167 0 245 13 412 68 198 66 325 145 473 294 235 237 349 490 366 811 31
590 -414 1140 -1016 1254 -105 20 -276 27 -372 15z m282 -99 c158 -20 319 -77
455 -162 89 -56 211 -156 268 -218 63 -70 183 -240 203 -287 21 -50 73 -319
80 -414 11 -149 -45 -398 -125 -556 -96 -192 -302 -386 -516 -489 -346 -165
-688 -164 -1022 5 -391 197 -625 565 -626 986 -1 231 57 428 184 625 63 97
258 285 355 343 240 142 488 198 744 167z"/>
<path d="M1999 1656 c-20 -7 -52 -22 -70 -32 -33 -19 -34 -23 -42 -100 -8 -87
1 -480 12 -522 9 -33 45 -42 60 -14 6 11 14 74 19 140 11 150 18 162 101 162
110 0 180 35 212 104 46 102 0 217 -103 261 -45 18 -139 19 -189 1z m147 -92
c40 -19 74 -58 74 -85 0 -11 -15 -35 -32 -54 -38 -41 -91 -55 -137 -36 -66 28
-69 140 -4 175 36 20 57 20 99 0z"/>
<path d="M259 1603 c-11 -13 -14 -84 -12 -381 1 -200 4 -366 6 -369 8 -8 355
-8 363 0 13 13 -10 41 -52 62 -27 13 -66 20 -131 23 l-93 4 -1 162 c0 247 -14
483 -29 501 -16 20 -34 19 -51 -2z"/>
<path d="M1484 1381 c-83 -39 -89 -57 -81 -255 6 -159 25 -259 57 -311 11 -18
20 -45 20 -59 0 -15 5 -37 12 -49 l12 -22 7 25 c4 14 7 91 8 173 l1 147 74 0
c117 0 184 32 217 104 34 74 16 170 -42 223 -67 61 -186 71 -285 24z m182 -77
c40 -19 74 -58 74 -85 0 -11 -15 -35 -32 -54 -38 -41 -91 -55 -137 -36 -66 28
-69 140 -4 175 36 20 57 20 99 0z"/>
<path d="M840 1371 c-127 -41 -216 -173 -236 -354 -6 -48 -4 -61 12 -78 11
-13 21 -44 25 -89 9 -86 35 -146 84 -195 131 -131 306 -83 400 108 83 171 60
389 -55 520 -61 70 -164 109 -230 88z m93 -105 c84 -35 140 -150 141 -291 1
-77 -3 -98 -25 -145 -88 -187 -231 -192 -312 -11 -32 72 -36 227 -7 304 25 67
65 117 112 140 40 20 50 21 91 3z"/>
<path d="M1297 982 c-31 -34 -247 -510 -297 -653 -15 -43 -8 -69 19 -69 27 0
65 49 112 142 l40 79 121 -3 121 -3 21 -85 c29 -120 65 -170 101 -140 22 18
19 70 -11 190 -14 58 -36 155 -49 215 -30 139 -87 293 -121 323 -30 27 -36 27
-57 4z m59 -288 c20 -78 23 -99 12 -105 -17 -11 -135 -11 -142 0 -7 10 92 216
100 208 3 -3 17 -49 30 -103z"/>
</g>
</svg>
	</div>
	<div class='col-xs-10'  style='height: 0px;'></div>
	<div class='col-xs-2' style='height: 0px;'>
			<!--svg class="" version="1.0" xmlns="http://www.w3.org/2000/svg" style='float:right; margin:5px; height:35px;'
	 width="256.000000pt" height="256.000000pt" viewBox="0 0 256.000000 256.000000"
	 preserveAspectRatio="xMidYMid meet"-->
<svg id="svgATP" class="svgATPWTA" version="1.1" id="Layer_2_1_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
			 viewBox="0 0 841.9 493.7" style="height: 60px;
    enable-background: new 0 0 841.9 493.7;
    margin-top: 5px;" xml:space="preserve">
			<style type="text/css">
				.st0{fill:#FFFFFF;}
				.st1{fill:none;}
			</style>
			<title>ATP_Tour_RGB_Stacked_Mono_POS</title>
	<g transform="translate(0.000000,256.000000) scale(0.100000,-0.100000)"
	fill="#000000" stroke="none">
	<path d="M1148 2489 c-332 -41 -663 -231 -864 -498 -107 -143 -193 -345 -225
	-531 -17 -104 -15 -297 5 -402 85 -443 401 -807 824 -948 151 -50 233 -63 397
	-63 167 0 245 13 412 68 198 66 325 145 473 294 235 237 349 490 366 811 31
	590 -414 1140 -1016 1254 -105 20 -276 27 -372 15z m282 -99 c158 -20 319 -77
	455 -162 89 -56 211 -156 268 -218 63 -70 183 -240 203 -287 21 -50 73 -319
	80 -414 11 -149 -45 -398 -125 -556 -96 -192 -302 -386 -516 -489 -346 -165
	-688 -164 -1022 5 -391 197 -625 565 -626 986 -1 231 57 428 184 625 63 97
	258 285 355 343 240 142 488 198 744 167z"/>
	<path d="M1999 1656 c-20 -7 -52 -22 -70 -32 -33 -19 -34 -23 -42 -100 -8 -87
	1 -480 12 -522 9 -33 45 -42 60 -14 6 11 14 74 19 140 11 150 18 162 101 162
	110 0 180 35 212 104 46 102 0 217 -103 261 -45 18 -139 19 -189 1z m147 -92
	c40 -19 74 -58 74 -85 0 -11 -15 -35 -32 -54 -38 -41 -91 -55 -137 -36 -66 28
	-69 140 -4 175 36 20 57 20 99 0z"/>
	<path d="M259 1603 c-11 -13 -14 -84 -12 -381 1 -200 4 -366 6 -369 8 -8 355
	-8 363 0 13 13 -10 41 -52 62 -27 13 -66 20 -131 23 l-93 4 -1 162 c0 247 -14
	483 -29 501 -16 20 -34 19 -51 -2z"/>
	<path d="M1484 1381 c-83 -39 -89 -57 -81 -255 6 -159 25 -259 57 -311 11 -18
	20 -45 20 -59 0 -15 5 -37 12 -49 l12 -22 7 25 c4 14 7 91 8 173 l1 147 74 0
	c117 0 184 32 217 104 34 74 16 170 -42 223 -67 61 -186 71 -285 24z m182 -77
	c40 -19 74 -58 74 -85 0 -11 -15 -35 -32 -54 -38 -41 -91 -55 -137 -36 -66 28
	-69 140 -4 175 36 20 57 20 99 0z"/>
	<path d="M840 1371 c-127 -41 -216 -173 -236 -354 -6 -48 -4 -61 12 -78 11
	-13 21 -44 25 -89 9 -86 35 -146 84 -195 131 -131 306 -83 400 108 83 171 60
	389 -55 520 -61 70 -164 109 -230 88z m93 -105 c84 -35 140 -150 141 -291 1
	-77 -3 -98 -25 -145 -88 -187 -231 -192 -312 -11 -32 72 -36 227 -7 304 25 67
	65 117 112 140 40 20 50 21 91 3z"/>
	<path d="M1297 982 c-31 -34 -247 -510 -297 -653 -15 -43 -8 -69 19 -69 27 0
	65 49 112 142 l40 79 121 -3 121 -3 21 -85 c29 -120 65 -170 101 -140 22 18
	19 70 -11 190 -14 58 -36 155 -49 215 -30 139 -87 293 -121 323 -30 27 -36 27
	-57 4z m59 -288 c20 -78 23 -99 12 -105 -17 -11 -135 -11 -142 0 -7 10 92 216
	100 208 3 -3 17 -49 30 -103z"/>
	</g>
	</svg>
	</div>
	<div id="divMenu"  class="container-fluid" style="  padding: 10px; white-space: nowrap; overflow-x: auto;">               
		<h4 class='titolo' onclick='location.reload();'>FantaLucca 2K22 </h4>
		<button class='btnMenu btn btn-success' onclick="CambiaPagina('C')">Classifica</button>
		<button class='btnMenu btn btn-primary' onclick="CambiaPagina('P')">Punteggi</button>
		<button class='btnMenu btn btn-danger' onclick="CambiaPagina('A')">Assegna</button>		
	</div>	
	<div class="container-fluid ElencoGiocatori" style="width:100%; padding: 0; ">		 		
		<h4 class="text-center">Classifica</h4>
		 
		<div id='divGiovatori' class='col-xs-12' style='padding:0; font-size: 1.1em;'>			 			
										
		</div>			
	</div> 
		
	<div class="container-fluid ElencoPunteggi" style="width:100%; padding: 0; display:none;  ">
		<h4 class="text-center">Punteggi</h4> 
		<div id='aaa'>
		
		</div>	
	</div>	

<div class="container-fluid AssegnaPunti" style="width:100%; padding: 0; display:none;  ">
		<h4 class="text-center">Assegna punti</h4> 
		<div class='col-xs-6'>
		<label class='lbl'>Giorno</label><br>
			<select id='cmbGiorno' class='form-control' style='width:150px'>
				<option value="0">Sabato 29</option>
				<option value="1">Domenica 30</option>
				<option value="2">Lunedì 31</option>
				<option value="3">Martedì 1</option>
			</select>
		</div>	
		<div class='col-xs-6'>
			<label class='lbl'>Giocatore</label><br>
			<select id='cmbPlayer'  class='form-control' style='width:150px'>
				
			</select>
		</div>
		<div class='col-xs-12'>
			<br><br>
			<label class='lbl'>Azione</label><br>
			<select id='cmbAzione' class='form-control' style='width:100%;'>
				
			</select>
		</div>
		<div class='col-xs-12' style='text-align:center'>
			<br>
			<button class='btn btn-success btnMenu' id='btnAssegna' onclick='SetPunteggio(1);'>
			Assegna
			</button>
			<span id='check' class="fa-solid fa-check ok" style='display:none; vertical-align: -5px'></label>
		</div>
		<div class='col-xs-12' style='text-align:center'>
			<br><br><br><br>
			<button class='btn btn-danger btnMenu' id='btnRimuovi onclick='SetPunteggio(-1);'>
			Rimuovi
			</button>
			<span id='check' class="fa-regular fa-x no" style='display:none; vertical-align: -5px'></label>			
		</div>		
	</div>	
	<div class="container-fluid" style="height:80px;"></div>			
	
</body> 

<script>
var url = 'https://us-central1-oloappi.cloudfunctions.net/user';
var arrAzioni, arrCodAzioni;
var arrGiocatori;
var arrPunteggiTotali;
//////var punteggi1,punteggi2,punteggi3,punteggi4
var punteggi = [];
var arrTotaliSquadra =[];
var azioni;
var finito;
var arrGetGiocatori;
var oAzioni;

$(document).ready(function(){

	arrGiocatori=[];
	arrPunteggiTotali=[];
	if(localStorage["PAGINA"]!= undefined){
		CambiaPagina(localStorage["PAGINA"]);
	}else{
		CambiaPagina('C');
	}
	
	getGiocatori();	
	
	getPunteggi(1);
	getPunteggi(2);
	getPunteggi(3);
	getPunteggi(4);
	getAzioni();
	
	setTimeout(function(){
		GetPunteggioGiocatore();			
	}, 1500);	

	BindCMB('cmbPlayer', arrGiocatori, []);
	BindCMB('cmbAzione', arrAzioni, arrCodAzioni);
	setTimeout(function(){
		SetPunti();			
	}, 1500);
	HideLoading(); 	
}); 


 function BindCMB(cmb, arrayDesc, arrValore = []){
	 try{
		 $("#" + cmb).html('');
		 $("#" + cmb).append($("<option style='font-weight: bold;'></option>").val('').html(''));
				
		if (arrValore.length==0)
		{			
			arrayDesc.forEach(Nome => $("#" + cmb).append($("<option style='font-weight: bold;'></option>").val(Nome).html(Nome)));					 
		}else{
			for (let i = 0; i< arrayDesc.length; ++i){				
				$("#" + cmb).append($("<option style='font-weight: bold;'></option>").val(arrValore[i]).html(arrayDesc[i]))				
			}
			/*let i = 0;			
			arrayDesc.forEach(Nome => $("#" + cmb).append($("<option style='font-weight: bold;'></option>").val('').html(Nome)));
			arrValore.forEach(Valore => $("#" + cmb).append($("<option style='font-weight: bold;'></option>").val(Nome)));*/
		}		 
				
	 }catch(exc){
		 console.log(ex)
	 } 
 }
	
function getAzioni(){
	$.ajax({  
	"Access-Control-Allow-Origin": "*",
		"Referrer Policy": "strict-origin-when-cross-origin",
		"url": "https://us-central1-oloappi.cloudfunctions.net/user/GetDati/azioni",   
		"method": "GET",
		"crossDomain": false,
		"dataType":"text",	
		"async" : false,			
		success: function (output)  
		{								
			azioni = JSON.parse(output);
						//;	
			arrAzioni=[];
			arrCodAzioni=[];	
			 
			for(let k = 0; k < azioni.length; ++k){
			 
				if(azioni[k].valore > 0){
					let kk = k+1;
					
					let y = '[(' + azioni[k].id + ') ' + azioni[k].valore + 'pt.] ' + azioni[k].descrizione;
					arrAzioni.push(y);
					
					arrCodAzioni.push(azioni[k].id)
				}
				
			}
		} ,
		 error: function(output) 
		 {					 
			console.log("Error in API getAzioni call:" + output);
			alert("Error in API getAzioni call:" + output);
		 }
			
	}); 
	
}
	
function getPunteggi(giorno){
	$.ajax({  
	"Access-Control-Allow-Origin": "*",
		"Referrer Policy": "strict-origin-when-cross-origin",
		"url": "https://us-central1-oloappi.cloudfunctions.net/user/GetDati/punteggi_" + giorno,   
		"method": "GET",
		"crossDomain": false,
		"dataType":"text",	
		"async" : false,			
		success: function (output)  
		{								
			punteggi[giorno -1] = JSON.parse(output);
		} ,
		 error: function(output) 
		 {					 
			console.log("Error in API getPunteggi_" + giorno + " call:" + output);
			alert("Error in API getAzioni_" + giorno + " call:" + output);
		 }
			
	}); 
	
}	
 
function getGiocatori(){		
	$.ajax({  
	"Access-Control-Allow-Origin": "*",
		"Referrer Policy": "strict-origin-when-cross-origin",
		"url": "https://us-central1-oloappi.cloudfunctions.net/user/GetDati/users",   		
		"method": "GET",
		"crossDomain": false,
		"dataType":"text",	
		"async" : false,			
		success: function (output )  
		{							  										
			 
			localStorage["giocatori"] =  output;
					
			//;
			let ret = JSON.parse(output)
			for(let k = 0; k < ret.length; ++k){
				let y = ret[k].nome
				arrGiocatori.push(y);	
			}
			arrGetGiocatori = ret;		
			popolaClassifica(arrGetGiocatori);
		} ,
		 error: function(output) 
		 {					
			console.log("Error in API getGiocatori call:" + output);
			alert("Error in API getGiocatori call:" + output);
		 }
			
	}); 	 
 }
 
function popolaClassifica(arr){
	let sHTML = '';	 
	sHTML += `<div class='col-xs-12' style='margin-bottom: 10px; font-size: 16px;'></div>`
	for (let i = 0; i< arr.length; ++i){		
		let index = [arrGiocatori.indexOf(arr[i].squadra.draft_1), arrGiocatori.indexOf(arr[i].squadra.draft_2), arrGiocatori.indexOf(arr[i].squadra.draft_3)];
				 
		sHTML += `
		<div class='col-xs-6 Giocatore ${arr[i].nome}'>
			<div class='col-xs-12 squadra' style='border: solid 1px #ffa500; border-radius:10px; padding:5px;margin-bottom:10px;'>
				<b style='margin-left: 5px;'>${SpezzaCaMel(arr[i].nome)}</b>&nbsp;
				<i class='hidden'>${arr[i].id}</i>
				<i class="fa-solid fa-trophy coppa coppa${arr[i].nome}" style="display:none;"></i>
				<ul>
					<li>${arr[i].squadra.draft_1} <i class='TotPlayer${index[0]}'></i> </li>
					<li>${arr[i].squadra.draft_2} <i class='TotPlayer${index[1]}'></i> </li>
					<li>${arr[i].squadra.draft_3} <i class='TotPlayer${index[2]}'></i> </li>
				</ul>
				<div class='col-xs-12' style='text-align:right'>&nbsp;<b class='TotaleSquadra${i}'></b>&nbsp;punti</div>				
			</div>				
		</div>`	
	}
 
	$('#divGiovatori').html(sHTML);
 
 }
 
 function SetPunti(){
	 let arr = arrGetGiocatori;
	 arrTotaliSquadra=[];
	 for(let i = 0; i< arrGiocatori.length; ++i){
		let index = [arrGiocatori.indexOf(arr[i].squadra.draft_1), arrGiocatori.indexOf(arr[i].squadra.draft_2), arrGiocatori.indexOf(arr[i].squadra.draft_3)];
		let totali = [arrPunteggiTotali[index[0]], arrPunteggiTotali[index[1]], arrPunteggiTotali[index[2]]];	
		 for(k =0; k<=2; ++k){
			 
			 if(totali[k] === undefined){totali[k] = 0;}
		 }
		 $('.TotPlayer' + index[0]).html(totali[0]);
		 $('.TotPlayer' + index[1]).html(totali[1]);
		 $('.TotPlayer' + index[2]).html(totali[2]);
		 let t = parseInt(totali[0]) + parseInt(totali[1]) + parseInt(totali[2]);
		 $('.TotaleSquadra' + i).html(t);		 
		 arrTotaliSquadra.push(t)
	 }
	 
	 	 //array con il punteggio della prima, seconda e terza squadra
	 let w = [...arrTotaliSquadra];
	 b = sort_unique(w).sort(function(a, b){return b-a})
	 b.length = 3;
	 arrTotaliSquadra.forEach((element, index) => {
		 
		 player = arrGetGiocatori[index].id;
		if(parseInt(element) == parseInt(b[0])){		
			
			$('.coppa' + player).css('color', '#FFD700').css('display', '')
			
		} 
		else if(parseInt(element) == parseInt(b[1])){
			 
			$('.coppa' + player).css('color', '#C0C0C0').css('display', '')
			
		} 
		else if(parseInt(element) == parseInt(b[2])){
			 
			$('.coppa' + player).css('color', '#CD7f32').css('display', '')
			
		} 
	 })
	 
 }
 
 function CambiaPagina(p){
	 localStorage["PAGINA"] = p;
	 switch(p){
		 case "C":
			$('.ElencoPunteggi').css('display', 'none');
			$('.ElencoGiocatori').css('display', '');
			$('.AssegnaPunti').css('display', 'none');
			break;		 
		 case "P":
			$('.ElencoPunteggi').css('display', '');
			$('.AssegnaPunti').css('display', 'none');
			$('.ElencoGiocatori').css('display', 'none');
			break;	
		case "A":
			$('.AssegnaPunti').css('display', '');
			$('.ElencoPunteggi').css('display', 'none');
			$('.ElencoGiocatori').css('display', 'none');
			break;				
	 }
	 
 }
  
 function GetPunteggioGiocatore(){
	 let punteggi1 = punteggi[0];
	 let punteggi2 = punteggi[1];
	 let punteggi3 = punteggi[2];
	 let punteggi4 = punteggi[3];
	
	 let sHTML = ''; 
	 let sNone = ''
	 for (i = 0; i < arrGiocatori.length; ++i){
	 	sHTML += creaHTMLgiocatore(punteggi1,punteggi2,punteggi3,punteggi4, arrGiocatori[i], sNone);
		sNone = 'display:none;'
	 }
	 $('#aaa').html(sHTML);
 }
 
 function creaHTMLgiocatore(giorno1,giorno2,giorno3, giorno4, player,sNone){
	let index = arrGiocatori.indexOf(player);
	let p1 = giorno1[index];	
	let p2 = giorno2[index];	
	let p3 = giorno3[index];	
	let p4 = giorno4[index];	
	let n = Object.keys(p1).length/2; 
	let sHTML = '';
	let tot = 0;
	
	sHTML +='<div id="div' + player + '" style="' + sNone + '">'
	sHTML +='<div class="col-xs-12">'
	let w = "'" + player + "'"
	sHTML +='<div class="col-xs-2"></div><div class="col-xs-2"><span class="glyphicon glyphicon-arrow-left freccia ' +player +'" onclick="Freccia(-1,' + w + ')"></span></div>'
	sHTML +='<div class="col-xs-4" style="padding: 0;text-align: center;"><b style="font-size:20px; margin-top: -5px">' + SpezzaCaMel(player) + '</b></div>'
	sHTML +='<div class="col-xs-2"><span class="glyphicon glyphicon-arrow-right freccia"  onclick="Freccia(+1,' + w + ')"></span></div><div class="col-xs-2"></div>'
	sHTML +='</div>'
	sHTML +='<div class="col-xs-12">'
	sHTML +='<table style="width:100%">'
	sHTML +='<tr>'
	sHTML +='<th>AZIONE</th>'
	sHTML +='<th class="text-center">PUNTI</th>	'		
	sHTML +='</tr>'	
	for (let i = 1; i<= azioni.length -1 ; ++i){ //-1 perchè escludo AZ29 da agg a db
	 
		let objAzione = getObjAzione(i-1);
		let descrizione = objAzione.descrizione;  //getDescAzione(i-1); 
		if (descrizione != ''){
			let punteggio = 'AZ' +i;
			let moltiplicatore =  parseInt(objAzione.valore);
			 		
			let somma =  (parseInt(p1[punteggio])+parseInt(p2[punteggio])+parseInt(p3[punteggio])+parseInt(p4[punteggio]))*moltiplicatore;			
			tot+=somma;
			
			sHTML +='<tr style="border-bottom: 1px solid rgba(231, 216, 216, 0.44); line-height: 25px;">'
			sHTML +='<td>[' + punteggio + '] ' + descrizione + '</td>'
			sHTML +='<td class="text-center">' + somma + '</td>'
			sHTML +='</tr>'	
		}		
	}
	
	sHTML +='</table>'	
	sHTML += '<div class="col-xs-11" style="text-align: right; margin-top: 15px;">'
	sHTML += '<b>Tot.</b>&nbsp;' + tot +' punti'
	sHTML += '</div>'	
	sHTML +='</div>'
	sHTML +='</div>' //chiudo il divGiocatore
 
	//let indexPlayer = arrGiocatori.indexOf(player)
	if (tot >= 0){
		arrPunteggiTotali[index] = tot;
	}else{
		arrPunteggiTotali[index] = 0;
	}
	
	return sHTML;
 }
 
 function Freccia(i, currentPlayerName){
  
	 let currentIndex = arrGiocatori.indexOf(currentPlayerName);
	 let n = arrGiocatori.length;
	 let next = (parseInt(currentIndex) + parseInt(i) + n) % n;
	  
	 let nextPlayerName = arrGiocatori[next];
	 //nascondo il corrente e mostroil prossimo
	 $('#div' + currentPlayerName).css('display', 'none');
	 $('#div' + nextPlayerName).css('display', '');
 }
 
 function SetPunteggio(k){
	 $('.ok').fadeOut();
	 $('.no').fadeIn();
	  
	 let index = arrGiocatori.indexOf($('#cmbPlayer').val());
	 jsonData = punteggi[$('#cmbGiorno').val()][index];
	 let CodiceAzione = $('#cmbAzione').val();
	 let newValore = parseInt(jsonData[CodiceAzione]) + k ;
	  //passo solo un json con quello che aggiorno
	 //let Data = '{' + CodiceAzione + ':"' + newValore + '"}'	 	non devo passarli in formato stringa!
	 let Json_Data = {};
	 Json_Data[CodiceAzione] = newValore;
	 let giorno = parseInt($('#cmbGiorno').val()) + 1;
	 let url = "https://us-central1-oloappi.cloudfunctions.net/user/SalvaDati/punteggi_" + giorno + "-" + $('#cmbPlayer').val();
	// console.log(url)
	 
	 $.ajax({  
		"Access-Control-Allow-Origin": "*",
		"Referrer Policy": "strict-origin-when-cross-origin",
		"url": url,
		"method": "PUT",
		"crossDomain": false,		 		 
		"data": Json_Data,		
		success: function (output)  
		{	
			if(k==1){
				$('.ok').fadeIn();
			}else{
				$('.no').fadeIn();
			}		
			
			Aggiorna();
		} ,
		 error: function(output) 
		 {					 
			console.log("Error in API SetPunteggio call:" + output.statusText);
			alert("Error in API SetPunteggio call:" + output);
		 }
			
	}); 
	 
	 
 }
 
 function getObjAzione(i){	
	 let j = i+1;
	 for (k =0; k<= azioni.length - 1;++k){		
		 if(azioni[k].id == 'AZ' + j) {			
			 return azioni[k];	
		 }	 
	 }	 
	 return '';
 }
 function ShowLoading(){
	$('#loader').css('display', '')
 }
 function HideLoading(){
	$('#loader').css('display', 'none')
 }
 
 function SpezzaCaMel(parola){
	let arr = [];
	let i = 0;
	for (i=0; i< parola.length; ++i){		
		if (parola[i] === parola[i].toUpperCase()){			
			arr.push(i);			
		}		
	}	
		
	let ret = '';
	//Ora in arr ho gli indici di tutte le maiuscole
	let j=0;
	for (j = 0; j<= arr.length - 2 ;++j){	
		let indexDa = arr[j];
		let indexA = arr[j + 1];
		let lungh = indexA - indexDa 		
		ret +=  parola.substr(arr[j], lungh ) + ' ';		
	}
	ret +=  parola.substr(arr[j]) + ' ';
	return ret
}

function aaa(id){
	//initial position
	let x0,y0,m, alt,lun;
	
	m = Math.pow(-1,Math.ceil(Math.random()*10))*Math.random()*10;	
	x0 = window.innerWidth/2;
	y0 = window.innerHeight/2;
	console.log('x0=' + x0)
	console.log('y0=' + y0)
	$('#' + id).offset({"top" : y0 , "left" : x0})
 
	alt = $('#' + id).css('height').replace('px','')/2
	lun = $('#' + id).css('width').replace('px','')/2
	console.log('alt=' + alt)
	console.log('lun=' + lun)
	
	let top,left 
	left = x0 -lun
	top = y0 - alt
	console.log('X=' + top)
	console.log('Y=' + left)
	$('#' + id).offset({"top" : top , "left" : left})
 

}

function Aggiorna(){
	
	setTimeout(function(){
		ShowLoading();			
	}, 15);
	let today = 1;
	switch(GetOggi().substring(8)){
		case "29": today = 1;
			break;		
		case "30": today = 2;
			break;
		case "31": today = 3;
			break;
		case "01": today = 4;
			break;
	}
	arrGiocatori=[];
	arrPunteggiTotali=[];
	getGiocatori();	
	
	getPunteggi(today);	
		
	setTimeout(function(){
		GetPunteggioGiocatore();			
	}, 1500);	
	
	setTimeout(function(){
		SetPunti();
		HideLoading();		
	}, 1500);	
}

 function GetOggi(){	 
	oggi = new Date();
	let anno = 1900 + oggi.getYear();
	let mese = 1+ oggi.getMonth();
	if (mese.toString().length == 1){mese = '0' + mese;}
	let giorno = oggi.getDate();
	if (giorno.toString().length == 1){giorno = '0' + giorno;} //if (giorno.length = 1) giorno = '0' + giorno
	oggi = anno + '-' + mese + '-' + giorno;
	return oggi;
 }
 
 function sort_unique(arr) {
  if (arr.length === 0) return arr;
  arr = arr.sort(function (a, b) { return a*1 - b*1; });
  var ret = [arr[0]];
  for (var i = 1; i < arr.length; i++) { //Start loop at 1: arr[0] can never be a duplicate
    if (arr[i-1] !== arr[i]) {
      ret.push(arr[i]);
    }
  }
  return ret;
}
</script>
</html>
